(function(c,e,d,a){function b(a,b){this.w=c(e);this.el=c(a);this.options=c.extend({},l,b);this.init()}var f="ontouchstart"in e,h=function(){var a=d.createElement("div"),b=d.documentElement;if(!("pointerEvents"in a.style))return!1;a.style.pointerEvents="auto";a.style.pointerEvents="x";b.appendChild(a);var c=e.getComputedStyle&&"auto"===e.getComputedStyle(a,"").pointerEvents;b.removeChild(a);return!!c}(),k=f?"touchstart":"mousedown",m=f?"touchmove":"mousemove",n=f?"touchend":"mouseup";eCancel=f?"touchcancel":
"mouseup";var l={listNodeName:"ol",itemNodeName:"li",rootClass:"dd",listClass:"dd-list",itemClass:"dd-item",dragClass:"dd-dragel",handleClass:"dd-handle",collapsedClass:"dd-collapsed",placeClass:"dd-placeholder",noDragClass:"dd-nodrag",emptyClass:"dd-empty",expandBtnHTML:'<button data-action="expand" type="button">Expand</button>',collapseBtnHTML:'<button data-action="collapse" type="button">Collapse</button>',group:0,maxDepth:5,threshold:20};b.prototype={init:function(){var a=this;a.reset();a.el.data("nestable-group",
this.options.group);a.placeEl=c('<div class="'+a.options.placeClass+'"/>');c.each(this.el.find(a.options.itemNodeName),function(b,f){a.setParent(c(f))});a.el.on("click","button",function(b){if(!a.dragEl&&(f||0===b.button)){var d=c(b.currentTarget);b=d.data("action");d=d.parent(a.options.itemNodeName);"collapse"===b&&a.collapseItem(d);"expand"===b&&a.expandItem(d)}});var b=function(b){var d=c(b.target);if(!d.hasClass(a.options.handleClass)){if(d.closest("."+a.options.noDragClass).length)return;d=d.closest("."+
a.options.handleClass)}!d.length||(a.dragEl||!f&&0!==b.button||f&&1!==b.touches.length)||(b.preventDefault(),a.dragStart(f?b.touches[0]:b))},d=function(b){a.dragEl&&(b.preventDefault(),a.dragMove(f?b.touches[0]:b))},h=function(b){a.dragEl&&(b.preventDefault(),a.dragStop(f?b.touches[0]:b))};f?(a.el[0].addEventListener(k,b,!1),e.addEventListener(m,d,!1),e.addEventListener(n,h,!1),e.addEventListener(eCancel,h,!1)):(a.el.on(k,b),a.w.on(m,d),a.w.on(n,h))},serialize:function(){var a=this;step=function(b,
f){var d=[];b.children(a.options.itemNodeName).each(function(){var b=c(this),h=c.extend({},b.data()),b=b.children(a.options.listNodeName);b.length&&(h.children=step(b,f+1));d.push(h)});return d};return step(a.el.find(a.options.listNodeName).first(),0)},serialise:function(){return this.serialize()},reset:function(){this.mouse={offsetX:0,offsetY:0,startX:0,startY:0,lastX:0,lastY:0,nowX:0,nowY:0,distX:0,distY:0,dirAx:0,dirX:0,dirY:0,lastDirX:0,lastDirY:0,distAxX:0,distAxY:0};this.moving=!1;this.dragRootEl=
this.dragEl=null;this.dragDepth=0;this.hasNewRoot=!1;this.pointEl=null},expandItem:function(a){a.removeClass(this.options.collapsedClass);a.children('[data-action="expand"]').hide();a.children('[data-action="collapse"]').show();a.children(this.options.listNodeName).show()},collapseItem:function(a){a.children(this.options.listNodeName).length&&(a.addClass(this.options.collapsedClass),a.children('[data-action="collapse"]').hide(),a.children('[data-action="expand"]').show(),a.children(this.options.listNodeName).hide())},
expandAll:function(){var a=this;a.el.find(a.options.itemNodeName).each(function(){a.expandItem(c(this))})},collapseAll:function(){var a=this;a.el.find(a.options.itemNodeName).each(function(){a.collapseItem(c(this))})},setParent:function(a){a.children(this.options.listNodeName).length&&(a.prepend(c(this.options.expandBtnHTML)),a.prepend(c(this.options.collapseBtnHTML)));a.children('[data-action="expand"]').hide()},unsetParent:function(a){a.removeClass(this.options.collapsedClass);a.children("[data-action]").remove();
a.children(this.options.listNodeName).remove()},dragStart:function(b){var f=this.mouse,h=c(b.target),e=h.closest(this.options.itemNodeName);this.placeEl.css("height",e.height());f.offsetX=b.offsetX!==a?b.offsetX:b.pageX-h.offset().left;f.offsetY=b.offsetY!==a?b.offsetY:b.pageY-h.offset().top;f.startX=f.lastX=b.pageX;f.startY=f.lastY=b.pageY;this.dragRootEl=this.el;this.dragEl=c(d.createElement(this.options.listNodeName)).addClass(this.options.listClass+" "+this.options.dragClass);this.dragEl.css("width",
e.width());e.after(this.placeEl);e[0].parentNode.removeChild(e[0]);e.appendTo(this.dragEl);c(d.body).append(this.dragEl);this.dragEl.css({left:b.pageX-f.offsetX,top:b.pageY-f.offsetY});h=this.dragEl.find(this.options.itemNodeName);for(b=0;b<h.length;b++)f=c(h[b]).parents(this.options.listNodeName).length,f>this.dragDepth&&(this.dragDepth=f)},dragStop:function(a){a=this.dragEl.children(this.options.itemNodeName).first();a[0].parentNode.removeChild(a[0]);this.placeEl.replaceWith(a);this.dragEl.remove();
this.el.trigger("change");this.hasNewRoot&&this.dragRootEl.trigger("change");this.reset()},dragMove:function(a){var b,f,k,l=this.options,g=this.mouse;this.dragEl.css({left:a.pageX-g.offsetX,top:a.pageY-g.offsetY});g.lastX=g.nowX;g.lastY=g.nowY;g.nowX=a.pageX;g.nowY=a.pageY;g.distX=g.nowX-g.lastX;g.distY=g.nowY-g.lastY;g.lastDirX=g.dirX;g.lastDirY=g.dirY;g.dirX=0===g.distX?0:0<g.distX?1:-1;g.dirY=0===g.distY?0:0<g.distY?1:-1;k=Math.abs(g.distX)>Math.abs(g.distY)?1:0;if(g.moving){g.dirAx!==k?(g.distAxX=
0,g.distAxY=0):(g.distAxX+=Math.abs(g.distX),0!==g.dirX&&g.dirX!==g.lastDirX&&(g.distAxX=0),g.distAxY+=Math.abs(g.distY),0!==g.dirY&&g.dirY!==g.lastDirY&&(g.distAxY=0));g.dirAx=k;g.dirAx&&g.distAxX>=l.threshold&&(g.distAxX=0,k=this.placeEl.prev(l.itemNodeName),0<g.distX&&(k.length&&!k.hasClass(l.collapsedClass))&&(b=k.find(l.listNodeName).last(),f=this.placeEl.parents(l.listNodeName).length,f+this.dragDepth<=l.maxDepth&&(b.length?(b=k.children(l.listNodeName).last(),b.append(this.placeEl)):(b=c("<"+
l.listNodeName+"/>").addClass(l.listClass),b.append(this.placeEl),k.append(b),this.setParent(k)))),0>g.distX&&(k=this.placeEl.next(l.itemNodeName),k.length||(f=this.placeEl.parent(),this.placeEl.closest(l.itemNodeName).after(this.placeEl),f.children().length||this.unsetParent(f.parent()))));b=!1;h||(this.dragEl[0].style.visibility="hidden");this.pointEl=c(d.elementFromPoint(a.pageX-d.body.scrollLeft,a.pageY-(e.pageYOffset||d.documentElement.scrollTop)));h||(this.dragEl[0].style.visibility="visible");
this.pointEl.hasClass(l.handleClass)&&(this.pointEl=this.pointEl.parent(l.itemNodeName));if(this.pointEl.hasClass(l.emptyClass))b=!0;else if(!this.pointEl.length||!this.pointEl.hasClass(l.itemClass))return;k=this.pointEl.closest("."+l.rootClass);var m=this.dragRootEl.data("nestable-id")!==k.data("nestable-id");g.dirAx&&!m&&!b||m&&l.group!==k.data("nestable-group")||(f=this.dragDepth-1+this.pointEl.parents(l.listNodeName).length,f>l.maxDepth||(a=a.pageY<this.pointEl.offset().top+this.pointEl.height()/
2,f=this.placeEl.parent(),b?(b=c(d.createElement(l.listNodeName)).addClass(l.listClass),b.append(this.placeEl),this.pointEl.replaceWith(b)):a?this.pointEl.before(this.placeEl):this.pointEl.after(this.placeEl),f.children().length||this.unsetParent(f.parent()),this.dragRootEl.find(l.itemNodeName).length||this.dragRootEl.append('<div class="'+l.emptyClass+'"/>'),m&&(this.dragRootEl=k,this.hasNewRoot=this.el[0]!==this.dragRootEl[0])))}else g.dirAx=k,g.moving=!0}};c.fn.nestable=function(a){var f=this;
this.each(function(){var d=c(this).data("nestable");d?"string"===typeof a&&"function"===typeof d[a]&&(f=d[a]()):(c(this).data("nestable",new b(this,a)),c(this).data("nestable-id",(new Date).getTime()))});return f||this}})(window.jQuery||window.Zepto,window,document);(function(){var c=!1,e=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(d){function a(){!c&&this.init&&this.init.apply(this,arguments)}var b=this.prototype;c=!0;var f=new this;c=!1;for(var h in d)f[h]="function"==typeof d[h]&&"function"==typeof b[h]&&e.test(d[h])?function(a,f){return function(){var c=this._super;this._super=b[a];var d=f.apply(this,arguments);this._super=c;return d}}(h,d[h]):d[h];a.prototype=f;a.prototype.constructor=a;a.extend=arguments.callee;
return a}})();var Util=function(){return new (Class.extend({s4:function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},guid:function(){return this.s4()+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+this.s4()+this.s4()}}))}();angular.module("d3-uml-modeler.constants",[]);angular.module("d3-uml-modeler.underscore",[]);angular.module("d3-uml-modeler.base",[]);angular.module("d3-uml-modeler.uml-abstract-factory",["d3-uml-modeler.underscore"]);angular.module("d3-uml-modeler.notifications",[]);angular.module("d3-uml-modeler.constants",[]);angular.module("d3-uml-modeler.view",[]);angular.module("d3-uml-modeler.filters",[]);angular.module("d3-uml-modeler.services",[]);angular.module("d3-uml-modeler.directives",[]);
angular.module("d3-uml-modeler.uml-diagram",["d3-uml-modeler.base","d3-uml-modeler.base","d3-uml-modeler.view"]);angular.module("d3-uml-modeler.uml-workspace",["d3-uml-modeler.base","d3-uml-modeler.uml-abstract-factory","d3-uml-modeler.constants","d3-uml-modeler.underscore","d3-uml-modeler.notifications"]);angular.module("d3-uml-modeler.uml-property",["d3-uml-modeler.base"]);angular.module("d3-uml-modeler.uml-classifier",["d3-uml-modeler.base"]);
angular.module("d3-uml-modeler.editor",["d3-uml-modeler.uml-workspace","d3-uml-modeler.uml-diagram","d3-uml-modeler.uml-classifier","d3-uml-modeler.uml-property"]);angular.module("d3-uml-modeler.menu",[]);angular.module("d3-uml-modeler.element-list",["d3-uml-modeler.underscore"]);angular.module("d3-uml-modeler.login",["firebase"]);
angular.module("d3-uml-modeler.run",["d3-uml-modeler.uml-abstract-factory","d3-uml-modeler.constants","d3-uml-modeler.uml-diagram","d3-uml-modeler.uml-classifier","d3-uml-modeler.uml-property"]).run(["Constants","UmlModelAbstractFactory","WorkspaceModelClass","DiagramModelClass","ClassifierModelClass","PropertyModelClass",function(c,e,d,a,b,f){e.registerUmlModelElementClass(c.WORKSPACE.TYPES.NORMAL,d);e.registerUmlModelElementClass(c.DIAGRAM.TYPES.CLASS_DIAGRAM,a);e.registerUmlModelElementClass(c.CLASSIFIER.TYPES.CLASS,
b);e.registerUmlModelElementClass(c.CLASSIFIER.TYPES.INTERFACE,b);e.registerUmlModelElementClass(c.PROPERTY.TYPES.CONSTANT,f);e.registerUmlModelElementClass(c.PROPERTY.TYPES.ATTRIBUTE,f);e.registerUmlModelElementClass(c.PROPERTY.TYPES.METHOD,f)}]);angular.module("d3-uml-modeler.view").factory("BaseView",["EventDispatcher","Notifications",function(c,e){return c.extend({notifications:null,$scope:null,config:null,$el:null,svgNode:null,colorScale:null,init:function(c,a,b){this.$scope=c;this.$el=a;this.config=b;this.notifications=e},initListeners:function(){},initParameters:function(){this.initColorScale()},initColorScale:function(){var c=this.generateColors();this.colorScale=d3.scale.ordinal().range(c)},render:function(){this.initParameters();
this.drawChart()},drawChart:function(){this.drawBase()},drawBase:function(){throw Error("This is an abstract method, you must override it.");},update:function(){this.initParameters()},marginTop:function(){return 0},marginRight:function(){return 0},marginBottom:function(){return 0},marginLeft:function(){return 0},generateColors:function(c){if("undefined"===typeof c&&null===c)throw Error("count is undefined");for(var a=[],b=0;b<c;b++){var f=void 0,h=void 0,e=void 0,f=Math.round(255*Math.random()),h=
Math.round(255*Math.random()),e=Math.round(255*Math.random()),f="rgba("+[f,h,e,0.5].join()+")";a.push(f)}return a},getChartIcon:function(){throw Error("This is an abstract method, you must override it.");},show:function(){this.$el.css("display","block").css("overflow","auto")},hide:function(){this.$el.css("display","none").css("overflow","hidden")},dispose:function(){this.svgNode.remove();this.svgNode=null}})}]);angular.module("d3-uml-modeler.underscore").constant("_",_);var app=angular.module("d3-uml-modeler","ngRoute firebase d3-uml-modeler.underscore d3-uml-modeler.uml-abstract-factory d3-uml-modeler.base d3-uml-modeler.notifications d3-uml-modeler.constants d3-uml-modeler.view d3-uml-modeler.filters d3-uml-modeler.services d3-uml-modeler.directives d3-uml-modeler.uml-diagram d3-uml-modeler.uml-classifier d3-uml-modeler.uml-property d3-uml-modeler.uml-workspace d3-uml-modeler.editor d3-uml-modeler.menu d3-uml-modeler.login d3-uml-modeler.element-list d3-uml-modeler.run".split(" "));
app.config(["$routeProvider",function(c){c.when("/home",{templateUrl:"views/main.html"});c.when("/add-diagram",{templateUrl:"views/add-diagram.html",controller:"AddDiagram"});c.otherwise({redirectTo:"/home"})}]);angular.module("d3-uml-modeler.run").run(function(){});angular.module("d3-uml-modeler.constants").constant("Constants",{FIREBASE:{URL:"https://modeler.firebaseio.com/",LOGIN_PROVIDERS:{TWITTER:"twitter",GITHUB:"github"}},MENU_HEIGHT:50,NAVBAR_HEIGHT:52,DIAGRAM_MARGIN:{TOP:0,RIGHT:0,BOTTOM:0,LEFT:0},ELEMENT_TYPES_TO_NAMES:{0:"Workspace",1:"Class Diagram",2:"Use Case Diagram",3:"State Diagram",4:"Class",5:"Interface",6:"Constant",7:"Attribute",8:"Method",9:"Association",10:"Generalization",11:"Aggregation",12:"Composition"},WORKSPACE:{TYPES:{NORMAL:0}},
DIAGRAM:{TYPES:{CLASS_DIAGRAM:1,USE_CASE_DIAGRAM:2,STATE_DIAGRAM:3},EVENTS:{ADD:"add_diagram",REMOVE:"remove_diagram"}},CLASSIFIER:{TYPES:{CLASS:4,INTERFACE:5},EVENTS:{ADD:"add_classifier",REMOVE:"remove_classifier"},VIEW:{DEFAULT_WIDTH:150,DEFAULT_HEIGHT:100,TITLE_HEIGHT:30,RESIZE_HANDLER_SIZE:5}},PROPERTY:{TYPES:{CONSTANT:6,ATTRIBUTE:7,METHOD:8},EVENTS:{ADD:"add_property",REMOVE:"remove_property"},PRIMITIVE_TYPES:{VOID:"void",STRING:"String",INT:"int",UINT:"uint",FLOAT:"Float",DOUBLE:"Double",DATE:"Date"}},
ASSOCIATION:{TYPES:{ASSOCIATION:9,GENERALIZATION:10,AGGREGATION:11,COMPOSITION:12},EVENTS:{ADD:"add_association",REMOVE:"remove_association"}},ELEMENT_LIST:[{name:"Diagrams",children:[{name:"Class Diagram",type:function(){return this.DIAGRAM.TYPES.CLASS_DIAGRAM}}]},{name:"Classifiers",children:[{name:"Class",type:function(){return this.CLASSIFIER.TYPES.CLASS}},{name:"Interface",type:function(){return this.CLASSIFIER.TYPES.INTERFACE}}]}]});angular.module("d3-uml-modeler.notifications").factory("EventDispatcher",function(){return Class.extend({listeners:{},listenersCount:0,addEventListener:function(c,e,d){this.listeners[c]||(this.listeners[c]=[]);this.listenersCount++;this.listeners[c].push({listener:e,context:d})},removeEventListener:function(c,e){if(this.listeners[c]){var d=this.listeners[c],a=0,b;for(b in d){if(d[b].listener===e)break;a++}-1!==a&&(this.listeners[c].splice(a,1),this.listenersCount--,0===this.listeners[c].length&&delete this.listeners[c])}},
dispatchEvent:function(){var c;if("string"!==typeof arguments[0])console.warn("EventDispatcher","First params must be an event type (String)");else if(this.listeners.hasOwnProperty(arguments[0])){c=this.listeners[arguments[0]];for(var e=0;e<c.length;e++){var d=Array.prototype.slice.call(arguments,1);c[e].listener.apply(c[e].context,d)}}else console.warn("no such registered event : "+arguments[0])},hasListeners:function(){return 0<this.listenersCount},hasListener:function(c){return this.listeners.hasOwnProperty(c)}})});angular.module("d3-uml-modeler.notifications").provider("Notifications",Class.extend({$get:["EventDispatcher",function(c){c=new c;c.notify=c.dispatchEvent;return c}]}));angular.module("d3-uml-modeler.base").factory("BaseController",function(){return Class.extend({$scope:null,init:function(c){this.$scope=c;this.initListeners();this.initScope()},initListeners:function(){this.$scope.$on("$destroy",this.destroy.bind(this))},initScope:function(){},destroy:function(c){}})});angular.module("d3-uml-modeler.uml-abstract-factory").factory("UmlModelAbstractFactory",["_","Constants",function(c,e){var d={};return{createModelHierarchy:function(a){if("undefined"===typeof a||null===a)throw Error("modelJSON is undefined/null");if(!c.has(a,"GUID"))throw Error("modelJSON is not valid");var b=this.createUmlModelElement(a.type,c.omit(a,"children"));c.has(a,"children")&&c.each(a.children,function(a,c,d){a=this.createModelHierarchy(a);b.addElement(a)},this);return b},createUmlModelElement:function(a,
b){if(!c.has(d,a))throw Error("type not found : "+a);var f=d[a],h=f?new f:null;console.log("UmlModelAbstractFactory::createUmlModelElement GUID="+h.GUID+", type="+a);if("undefined"!==typeof h&&null!==h)"undefined"!==typeof b&&null!==b&&c.each(b,function(a,b,f){h[b]=a});else throw Error("UmlModelAbstractFactory::createUmlModelElement invalid model, please check out the type : "+a);return h},registerUmlModelElementClass:function(a,b){if("undefined"===typeof a||null===a)throw Error("UmlModelAbstractFactory::registerUmlModelElementClass undefined/null type");
if(!c.has(e.ELEMENT_TYPES_TO_NAMES,a))throw Error("UmlModelAbstractFactory::registerUmlModelElementClass type not valid : "+a);d[a]=b;return this},unregisterUmlModelElementClass:function(a,b){c.has(d,a)&&d[a]===b&&(d[a]=null,delete d[a]);return this},types:d}}]);angular.module("d3-uml-modeler.base").factory("BaseModelElement",["EventDispatcher","UmlModelAbstractFactory","Constants","_",function(c,e,d,a){return c.extend({count:0,children:{},GUID:null,description:"",selected:!1,name:"",type:0,init:function(){this.GUID=Util.guid();this.initElements()},getFields:function(){return["GUID","name","type","description","count"]},toJSON:function(){var b=a.pick(this,this.getFields());null!=this.children&&(b.children={},a.each(this.children,function(a){b.children[a.GUID]=
a.toJSON()}));return b},initElements:function(){this.children={}},createElement:function(b,f){if("undefined"===typeof b||null===b)throw Error("element type is undefined");if(!a.has(d.ELEMENT_TYPES_TO_NAMES,b))throw Error("element type is not valid");f=f||{};f=a.extend({name:"untitled "+d.ELEMENT_TYPES_TO_NAMES[b],type:b},f);var c=e.createUmlModelElement(b,f);return this.addElement(c)},addElement:function(a){if("undefined"===typeof a||null===a)throw Error("element is undefined");this.children[a.GUID]=
a;this.count++;return a},removeElement:function(a){if("undefined"===typeof a||null===a)throw Error("element is undefined");a="string"===typeof a?a:a.GUID;this.children[a]=null;delete this.children[a];this.count--;return this},clearChildren:function(){for(;!a.isEmpty(this.children);)this.children[a.keys(this.children)[0]]=null,delete this.children[a.keys(this.children)[0]]},clear:function(){this.name="";this.count=this.type=0;this.description=this.GUID="";this.clearChildren()},clone:function(b){return a.clone(this)}})}]);angular.module("d3-uml-modeler.base").factory("UmlController",["BaseController","Notifications",function(c,e){return c.extend({notifications:null,init:function(d,a){this.notifications=a;c.prototype.init.call(this,d)}})}]);angular.module("d3-uml-modeler.base").factory("BaseDirective",["BaseController",function(c){return c.extend({$element:null,$attributes:null,view:null,init:function(e,d,a){c.prototype.init.call(this,e);this.$element=d;this.$attributes=a}})}]);angular.module("d3-uml-modeler.base").factory("FirebaseSync",["_","Constants","$firebase",function(c,e,d){return Class.extend({firebaseUsers:null,init:function(){this.getUsers()},getUser:function(a){return d(new Firebase(e.FIREBASE.URL+"users/"+a+"/"))},getUserDiagrams:function(a){return new Firebase(e.FIREBASE.URL+"users/"+a+"/diagrams/")},getUsers:function(){this.firebaseUsers=d(new Firebase(e.FIREBASE.URL+"users"))},sync:function(a){this.firebaseUsers[a.uid]=a;this.firebaseUsers.$save(a.uid)}})}]);
angular.module("d3-uml-modeler.base").provider("FirebaseSyncController",Class.extend({$get:["FirebaseSync",function(c){return new c}]}));angular.module("d3-uml-modeler.login").controller("LoginController",["$scope","_","UserModel","Constants","UmlController","$firebaseSimpleLogin","$rootScope","FirebaseSyncController",function(c,e,d,a,b,f,h,k){return new (b.extend({auth:null,isPending:!1,isModelSynced:!1,initScope:function(){this.$scope.model=new d;this.$scope.socialLogin=angular.bind(this,this.socialLogin)},initListeners:function(){h.$on("$firebaseSimpleLogin:login",angular.bind(this,this.onLoginSuccess));h.$on("$firebaseSimpleLogin:logout",
angular.bind(this,this.onLogout));h.$on("$firebaseSimpleLogin:error",angular.bind(this,this.onLoginError))},onLoginSuccess:function(a,b){this.isPending=!this.isPending;this.isModelSynced||this.initModelUser(b)},onLoginError:function(a){this.auth.$logout();this.isPending=!1;console.log(a)},onLogout:function(){this.isPending=!1;for(var a in this.$scope.model)this.$scope.model.uid=null;console.log("logged out")},socialLogin:function(b){b===a.FIREBASE.LOGIN_PROVIDERS.TWITTER&&(this.isPending=!1,this.auth=
new f(new Firebase(a.FIREBASE.URL)),this.auth.$login(a.FIREBASE.LOGIN_PROVIDERS.TWITTER))},initModelUser:function(a){this.isModelSynced=!0;this.isPending=!1;this.$scope.model.uid=a.uid}}))(c,d,a)}]);angular.module("d3-uml-modeler.login").factory("UserModel",["Constants","_",function(c,e){return Class.extend({uid:"",displayName:"",username:"",id:"",accessToken:"",accessTokenSecret:"",firebaseAuthToken:"",provider:"",thirdPartyUserData:"",diagrams:{}})}]);app=angular.module("d3-uml-modeler.menu");app.controller("MenuCtrl",["$scope",function(c){c.items=[{name:"Undo",link:"#"},{name:"Redo",link:"#"}]}]);angular.module("d3-uml-modeler.editor").factory("PropertyEditorDirective",["BaseDirective","Constants","Notifications",function(c,e,d){return c.extend({notifications:null,originalModel:null,init:function(a,b,f){this.notifications=d;c.prototype.init.call(this,a,b,f);this.$scope.mode="add";this.initEditorListeners()},initEditorListeners:function(){this.notifications.addEventListener("edit-property-request",this.onEditPropertyRequested,this);this.$scope.addProperty=angular.bind(this,this.onAddPropertyClick);
this.$scope.saveProperty=angular.bind(this,this.saveProperty)},onAddPropertyClick:function(){this.$scope.$emit("add-property",{newPropertyElementType:+this.$attributes.elementType,newPropertyUmlType:this.$scope.newPropertyUmlType,newPropertyName:this.$scope.newPropertyName});this.$scope.newPropertyName="";this.$scope.newPropertyUmlType="";this.$scope.newPropertyElementType="";this.$element.find("#input-new-property").focus()},onEditPropertyRequested:function(a){+this.$attributes.elementType===a.type&&
(this.originalModel=a,this.$scope.newPropertyName=a.name,this.$scope.newPropertyUmlType=a.propertyType,this.$scope.newPropertyElementType=a.type,this.$scope.mode="edit")},saveProperty:function(){this.originalModel.name=this.$scope.newPropertyName;this.originalModel.propertyType=this.$scope.newPropertyUmlType;this.originalModel.type=this.$scope.newPropertyElementType;this.$scope.newPropertyName="";this.$scope.newPropertyUmlType="";this.$scope.newPropertyElementType="";this.$scope.mode="add"},render:function(){var a=
this.$element.height();this.$element.css("top",-a+"px")}})}]);angular.module("d3-uml-modeler.editor").factory("ClassifierEditorDirective",["BaseDirective","Constants","Notifications",function(c,e,d){return c.extend({notifications:null,originalModel:null,init:function(a,b,f){this.notifications=d;c.prototype.init.call(this,a,b,f);this.render();this.initEditorListeners()},initEditorListeners:function(){this.notifications.addEventListener("edit-classifier",this.onEditClassifierRequested,this);this.$element.find("#button-cancel").bind("click",angular.bind(this,this.onCancelClick));
this.$element.find("#button-add-property").bind("click",angular.bind(this,this.onAddPropertyClick));this.$element.find("#button-save").bind("click",angular.bind(this,this.onEditorSave));this.$scope.$on("add-property",this.addProperty());this.$scope.$on("remove-property",this.removeProperty())},removeProperty:function(){var a=this;return function(b,c){a.$scope.model.removeElement(c.GUID)}},addProperty:function(){var a=this;return function(b,c){a.$scope.model.addProperty(c.newPropertyElementType,{name:c.newPropertyName,
propertyType:c.newPropertyUmlType})}},onEditorSave:function(){var a=this;this.$scope.$apply(function(){a.originalModel.name=a.$scope.model.name;a.originalModel.description=a.$scope.model.description;a.originalModel.clearChildren();_.each(a.$scope.model.children,function(b){a.originalModel.children[b.GUID]=b.clone(!0)})});this.hideEditor();this.clear()},onCancelClick:function(){this.hideEditor();this.clear();this.$scope.$digest()},onEditClassifierRequested:function(a){this.originalModel=a;this.$scope.model=
a.clone(!0);this.$scope.$apply();this.showEditor()},showEditor:function(){this.$element.css("left","0px");this.$element.find("input").removeAttr("disabled");this.$element.find("textarea").removeAttr("disabled");this.$element.find("button").removeAttr("disabled")},hideEditor:function(){this.$element.css("left","-300px");this.$element.find("input").attr("disabled","true");this.$element.find("textarea").attr("disabled","true");this.$element.find("button").attr("disabled","true")},clear:function(){this.$scope.model.clear()},
render:function(){var a=this.$element.height();this.$element.css("top",-a+"px")}})}]);angular.module("d3-uml-modeler.editor").directive("editor",["_","Constants","ClassifierEditorDirective","PropertyEditorDirective",function(c,e,d,a){return{scope:{},restrict:"E",replace:!0,templateUrl:function(a,c){return"views/"+c.elementTypeName+"-editor.html"},controller:["$scope","$element","$attrs",function(a,f,d){"property"==d.elementTypeName&&(a.primitiveTypes=c.values(e.PROPERTY.PRIMITIVE_TYPES))}],link:function(b,c,e){"classifier"==e.elementTypeName&&new d(b,c,e);"property"==e.elementTypeName&&
new a(b,c,e)}}}]);angular.module("d3-uml-modeler.uml-property").factory("PropertyModelClass",["BaseModelElement",function(c){return c.extend({propertyType:"",init:function(e,d){c.prototype.init.call(this);this.name=e;this.type=d;this.children=null},addProperty:function(c,d){return this.createElement(c,d)},getFields:function(){var e=c.prototype.getFields.call(this);e.push("propertyType");return e}})}]);angular.module("d3-uml-modeler.uml-property").factory("PropertyDirective",["BaseDirective","Constants","Notifications",function(c,e,d){return c.extend({init:function(a,b,f){c.prototype.init.call(this,a,b,f)}})}]);
angular.module("d3-uml-modeler.uml-property").directive("property",["Notifications",function(c){return{templateUrl:"views/property.html",controller:["$scope","$element","$attrs",function(e,d,a){e.edit=angular.bind(this,function(){c.notify("edit-property-request",e.property)});e.remove=angular.bind(this,function(){e.$emit("remove-property",e.property)})}],link:function(c,d,a){}}}]);angular.module("d3-uml-modeler.uml-classifier").factory("ClassifierModelClass",["BaseModelElement","_",function(c,e){return c.extend({init:function(d,a){c.prototype.init.call(this);this.name=d;this.type=a},addProperty:function(c,a){return this.createElement(c,a)},clone:function(d){var a=c.prototype.clone.call(this,d);if(!0===d){var b={};e.each(a.children,function(a){b[a.GUID]=a.clone()});a.children=b}return a}})}]);angular.module("d3-uml-modeler.uml-classifier").factory("ClassifierResizer",["BaseView","Constants","_",function(c,e,d){return c.extend({resizerHandlersDragBehavior:null,resizer:null,selectedResizerHandler:null,init:function(a,b,f){c.prototype.init.call(this,a,b,f);this.svgNode=d3.select(this.$el);this.resizer=d3.select(this.$el.parentNode).select(".resizer");this.resizerRect=d3.select(this.$el.parentNode).select(".resizer-bg");this.handlersCoordinates=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,
y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}];this.resizer.selectAll(".resizer-handler").data(this.handlersCoordinates).enter().append("rect").attr("class",function(a,b){return"resizer-handler side-"+b}).attr("side-index",function(a,b){return b}).attr("width",e.CLASSIFIER.VIEW.RESIZE_HANDLER_SIZE).attr("height",e.CLASSIFIER.VIEW.RESIZE_HANDLER_SIZE);this.resizer.style("visibility","hidden");this.initListeners()},initListeners:function(){this.initDragBehaviors()},initDragBehaviors:function(){this.resizerHandlersDragBehavior=
d3.behavior.drag().origin(Object).on("dragstart",this.onResizerHandlersDragStart()).on("drag",this.onResizerHandlersDragMove()).on("dragend",this.onResizerHandlersDragEnd());this.resizer.selectAll(".resizer-handler").call(this.resizerHandlersDragBehavior)},getBox:function(){var a={};a.x=+this.resizerRect.attr("x");a.y=+this.resizerRect.attr("y");a.width=+this.resizerRect.attr("width");a.height=+this.resizerRect.attr("height");return a},showResizer:function(){this.resizer.style("visibility","visible");
this.updateResizer()},hideResizer:function(){this.resizer.style("visibility","hidden");this.updateResizer()},updateResizerRect:function(a){var b=e.CLASSIFIER.VIEW.RESIZE_HANDLER_SIZE;this.resizerRect.attr("x",function(){return 0>a.width?a.x+a.width+b:a.x}).attr("y",function(){return 0>a.height?a.y+a.height+b:a.y}).attr("width",function(){var c=Math.abs(a.width)-2*b;return 0>a.width?0<c?c:0:a.width}).attr("height",function(){var c=Math.abs(a.height)-2*b;return 0>a.height?0<c?c:0:a.height})},updateResizer:function(a){var b=
a||this.$el.getBBox(),c=e.CLASSIFIER.VIEW.RESIZE_HANDLER_SIZE;a&&this.updateResizerRect(a);this.handlersCoordinates=[{x:-c+b.x,y:-c+b.y},{x:b.width/2-c/2+b.x,y:-c+b.y},{x:b.width+b.x,y:-c+b.y},{x:b.width+b.x,y:b.height/2-c/2+b.y},{x:b.width+b.x,y:b.height+b.y},{x:b.width/2-c/2+b.x,y:b.height+b.y},{x:-c+b.x,y:b.height+b.y},{x:-c+b.x,y:b.height/2-c/2+b.y}];null!==this.selectedResizerHandler&&(a=d3.select(this.selectedResizerHandler).attr("side-index"),this.handlersCoordinates[a]={x:d3.select(this.selectedResizerHandler).attr("x"),
y:d3.select(this.selectedResizerHandler).attr("y")});this.resizer.selectAll(".resizer-handler").data(this.handlersCoordinates).attr("x",function(a,b){return a.x}).attr("y",function(a,b){return a.y})},updateResizerBoundingBox:function(){var a=+d3.select(this.selectedResizerHandler).attr("side-index"),b=0,c=0,d=0,k=0;if(0===a||4===a)b=+this.resizer.select(".side-0").attr("x"),c=+this.resizer.select(".side-0").attr("y"),d=+this.resizer.select(".side-4").attr("x"),k=+this.resizer.select(".side-4").attr("y");
if(1===a||5===a)b=+this.resizer.select(".side-0").attr("x"),c=+this.resizer.select(".side-1").attr("y"),d=+this.resizer.select(".side-4").attr("x"),k=+this.resizer.select(".side-5").attr("y");if(2===a||6===a)b=+this.resizer.select(".side-6").attr("x"),c=+this.resizer.select(".side-2").attr("y"),d=+this.resizer.select(".side-2").attr("x"),k=+this.resizer.select(".side-6").attr("y");if(3===a||7===a)b=+this.resizer.select(".side-7").attr("x"),c=+this.resizer.select(".side-0").attr("y"),d=+this.resizer.select(".side-3").attr("x"),
k=+this.resizer.select(".side-4").attr("y");a=e.CLASSIFIER.VIEW.RESIZE_HANDLER_SIZE;this.updateResizer(this.parseBoundingBox({x:b+a,y:c+a,width:d,height:k}))},parseBoundingBox:function(a){var b={};b.x=a.x;b.y=a.y;b.width=a.width-a.x;b.height=a.height-a.y;return b},widthLimit:100,heightLimit:60,onResizerHandlersDragStart:function(){var a=this;return function(b){console.log("DiagramView::onResizerHandlersDragStart");a.selectedResizerHandler=this;d3.event.sourceEvent.stopPropagation()}},onResizerHandlersDragMove:function(){var a=
this;return function(b){var c=+d3.select(this).attr("side-index");if(0!==c%2){if(3===c||7===c)b.x=d3.event.x;if(1===c||5===c)b.y=d3.event.y}else b.x=d3.event.x,b.y=d3.event.y;d3.select(this).attr("x",b.x).attr("y",b.y);a.updateResizerBoundingBox();d3.event.sourceEvent.stopPropagation()}},onResizerHandlersDragEnd:function(){var a=this;return function(b){a.updateResizerBoundingBox();a.selectedResizerHandler=null;a.dispatchEvent("resize-done-"+a.$scope.model.GUID);a.updateResizer()}},resetResizer:function(){var a=
this.svgNode.select(".classifier-foreign-object").attr("width"),b=this.svgNode.select(".classifier-foreign-object").attr("height");this.resizerRect.attr("x",a/2).attr("y",b/2).attr("width",0).attr("height",0)}})}]);angular.module("d3-uml-modeler.uml-classifier").factory("ClassifierPicker",["BaseView","Constants","_",function(c,e,d){return c.extend({picker:null,foreignObject:null,classifierWidth:0,init:function(a,b,d){c.prototype.init.call(this,a,b,d);this.classifierWidth=this.config.width;this.picker=d3.select(this.$el.parentNode).select(".controls-picker");this.initForeignObject()},setClassifierWidth:function(a){this.classifierWidth=a;this.updateForeignObject()},getPicker:function(){return this.picker},initForeignObject:function(){this.foreignObject=
this.picker.append("foreignObject").attr("class","picker-foreign-object");this.updateForeignObject()},updateForeignObject:function(){this.picker.select(".picker-foreign-object").attr("x",this.classifierWidth).attr("y",0).attr("width",30).attr("height",100).attr("style","fill:turquoise")},drawBase:function(){var a=this.foreignObject.append("xhtml:div").style("position","static");a.append("xhtml:button").attr("class","button-edit-classifier").on("click",angular.bind(this,this.onEditClassifierClick));
a.append("xhtml:button").attr("class","button-add-association")},onEditClassifierClick:function(){this.notifications.notify("edit-classifier",this.$scope.model)},showPicker:function(){this.picker.transition().attr("transform","translate(0,0)").attr("disabled",null)},hidePicker:function(){this.picker.transition().attr("transform","translate(-30,0)").attr("disabled","true")}})}]);angular.module("d3-uml-modeler.uml-classifier").factory("ClassifierView",["BaseView","Constants","_","$compile","ClassifierResizer","ClassifierPicker",function(c,e,d,a,b,f){return c.extend({backgroundRect:null,propertiesContainer:null,classifierDragBehavior:null,classifierResizer:null,selected:!1,handlersCoordinates:null,picker:null,init:function(a,b,d){c.prototype.init.call(this,a,b,d);this.svgNode=d3.select(this.$el);this.initClassifierPicker();this.initResizer();this.initListeners();this.initDragBehaviors()},
initClassifierPicker:function(){this.picker=new f(this.$scope,this.$el,this.config);this.picker.render();this.picker.hidePicker()},initResizer:function(){this.classifierResizer=new b(this.$scope,this.$el,this.config);this.classifierResizer.hideResizer();this.classifierResizer.addEventListener("resize-done-"+this.$scope.model.GUID,this.onClassifeierResizerDone,this)},initListeners:function(){this.notifications.addEventListener("hide-resizer",this.onHideResizer,this);d3.select(this.$el.parentNode).on("mousedown",
angular.bind(this,this.onClassifierMouseDown));this.notifications.addEventListener("hit-test",this.selectorHitTest,this)},initDragBehaviors:function(){this.classifierDragBehavior=d3.behavior.drag().origin(Object).on("drag",this.onDragMove);d3.select(this.$el.parentNode).attr("transform","translate(300,100)").datum({x:300,y:100}).call(this.classifierDragBehavior)},onClassifierMouseDown:function(){d3.event.ctrlKey||this.notifications.notify("hide-resizer",this.$scope.model.GUID);d3.event.stopPropagation();
d3.event.defaultPrevented||this.select()},selectorHitTest:function(a,b){if("undefined"===typeof a||null===a)throw Error("svg is undefined/null");if("undefined"===typeof b||!(b instanceof SVGRect)||null===b)throw Error("selectorRect is undefined or null or not an intance of SVGRect");a.checkIntersection(this.backgroundRect[0][0],b)&&this.select()},select:function(){this.selected=!0;var a=this;this.$scope.$apply(function(){a.$scope.model.selected=!0});this.notifications.notify("classifier-selected",
this.$scope.model);this.classifierResizer.showResizer();this.picker.showPicker()},deselect:function(){this.selected=!1;var a=this;this.$scope.$apply(function(){a.$scope.model.selected=!1});this.notifications.notify("classifier-deselected",this.$scope.model)},onClassifeierResizerDone:function(){var a,b,c,d;a=+d3.select(this.$el.parentNode).data()[0].x;b=+d3.select(this.$el.parentNode).data()[0].y;var f=this.classifierResizer.getBox();a=f.x+a;b=f.y+b;0<f.width&&0<f.height&&(c=f.width,d=f.height);d3.select(this.$el.parentNode).attr("transform",
"translate("+a+","+b+")").datum({x:a,y:b});0<f.width&&0<f.height&&(this.config.width=c,this.config.height=d);this.classifierResizer.resetResizer();this.updateBackground();this.picker.setClassifierWidth(this.config.width);this.updatePropertiesContainer()},onHideResizer:function(a){!this.classifierResizer||"undefined"!==typeof a&&null!==a&&a===this.$scope.model.GUID||(this.classifierResizer.hideResizer(),this.picker.hidePicker(),this.deselect())},onDragMove:function(a){a.x+=d3.event.dx;a.y+=d3.event.dy;
d3.select(this).attr("transform","translate("+a.x+","+a.y+")")},drawBase:function(){this.drawBackground();this.drawTitle();this.drawBody();this.updateClassifierSize()},updateClassifierSize:function(){if(!d.isEmpty(this.$scope.model.children)){var a;this.svgNode.select(".classifier-bg").attr("width");a=2+this.config.titleHeight;var b=20*d.keys(this.$scope.model.children).length;a+=b;a>e.CLASSIFIER.VIEW.DEFAULT_HEIGHT&&(this.config.height=a,this.updateBackground(),this.updatePropertiesContainer())}},
drawBackground:function(){this.backgroundRect=this.svgNode.append("svg:rect").attr("class","classifier-bg").attr("width",this.config.width).attr("height",this.config.height).attr("x",0).attr("y",0);d3.select(this.$el.parentNode).attr("data-width",this.config.width).attr("data-height",this.config.height);this.classifierForeignObject=this.svgNode.append("foreignObject").attr("class","classifier-foreign-object");this.updateClassifierForeignObject()},updateClassifierForeignObject:function(){this.svgNode.select(".classifier-foreign-object").attr("x",
0).attr("y",0).attr("width",this.config.width).attr("height",this.config.height)},drawTitle:function(){this.classifierContainerDiv=this.classifierForeignObject.append("xhtml:div").attr("class","classifier-title").style("height",this.config.titleHeight+"px").style("line-height",this.config.titleHeight+"px");var b=angular.element("<span>{{model.name}}</<span>"),b=a(b)(this.$scope);$(this.classifierContainerDiv[0][0]).append(b[0])},updateBackground:function(){this.svgNode.select("rect.classifier-bg").attr("width",
this.config.width).attr("height",this.config.height);d3.select(this.$el.parentNode).attr("data-width",this.config.width).attr("data-height",this.config.height);this.classifierForeignObject.attr("width",this.config.width).attr("height",this.config.height)},drawBody:function(){this.initPropertiesContainerDiv();var b;b='<div ng-repeat="property in model.children | propertyTypeFilter:{type: 6}" property class="uml-property"></div><div ng-repeat="property in model.children | propertyTypeFilter:{type: 7}" property class="uml-property"></div><div ng-repeat="property in model.children | propertyTypeFilter:{type: 8}" property class="uml-property"></div>';
debugger;b=angular.element(b);b=a(b)(this.$scope);$(this.propertiesContainerDiv[0][0]).append(b[0]);$(this.propertiesContainerDiv[0][0]).append(b[1]);$(this.propertiesContainerDiv[0][0]).append(b[2])},initPropertiesContainerDiv:function(a){this.propertiesContainerDiv=this.classifierForeignObject.append("xhtml:div").attr("class","property-container").style("position","static");this.updatePropertiesContainer()},updatePropertiesContainer:function(){$(this.propertiesContainerDiv[0][0]).css("height",this.config.height-
this.config.titleHeight)}})}]);angular.module("d3-uml-modeler.uml-classifier").factory("ClassifierDirective",["ClassifierView","BaseDirective","Constants","Notifications",function(c,e,d,a){return e.extend({init:function(a,c,d){e.prototype.init.call(this,a,c,d);this.draw()},draw:function(){var a={width:d.CLASSIFIER.VIEW.DEFAULT_WIDTH,height:d.CLASSIFIER.VIEW.DEFAULT_HEIGHT,titleHeight:d.CLASSIFIER.VIEW.TITLE_HEIGHT};console.log("ClassifierDirective::draw");this.view=new c(this.$scope,this.$element[0],a);this.view.render()}})}]);
angular.module("d3-uml-modeler.uml-classifier").directive("classifier",["ClassifierDirective",function(c){return{restrict:"A",link:function(e,d,a){new c(e,d,a)}}}]);angular.module("d3-uml-modeler.uml-classifier").controller("ClassifierController",["$scope","_","Notifications","Constants","UmlController",function(c,e,d,a,b){return new (b.extend({model:null,init:function(a){b.prototype.init.call(this,a,d)},initScope:function(){this.$scope.initModel=angular.bind(this,this.initModel)},initModel:function(a){this.model=a;this.$scope.model=angular.bind(this,this.model);this.$scope.properties=angular.bind(this,this.model.children);this.$scope.children=angular.bind(this,
this.model.children)},initListeners:function(){this.notifications.addEventListener(a.PROPERTY.EVENTS.ADD,this.addProperty,this)},addProperty:function(a){this.model.addProperty(a)}}))(c)}]);angular.module("d3-uml-modeler.uml-diagram").factory("DiagramModelClass",["BaseModelElement",function(c){return c.extend({init:function(e,d){c.prototype.init.call(this);this.name=e;this.type=d},addClassifier:function(c,d){return this.createElement(c,d)},removeClassifier:function(c){return this.removeElement(c)}})}]);angular.module("d3-uml-modeler.uml-diagram").controller("ClassDiagramController",["$scope","_","Notifications","Constants","UmlController",function(c,e,d,a,b){return new (b.extend({model:null,init:function(a){b.prototype.init.call(this,a,d)},initScope:function(){this.$scope.initModel=angular.bind(this,this.initModel);this.$scope.removeClassifier=angular.bind(this,this.removeClassifier)},initModel:function(a){this.model=a;this.$scope.model=angular.bind(this,this.model);this.$scope.classifiers=angular.bind(this,
this.model.children);this.$scope.children=angular.bind(this,this.model.children)},initListeners:function(){this.notifications.addEventListener(a.CLASSIFIER.EVENTS.ADD,this.addClassifier,this)},addClassifier:function(a){this.model.addClassifier(a)},removeClassifier:function(a){if("undefined"===typeof a||null===a)throw Error("guidList is undefined/null");var b=this;this.$scope.$apply(function(){b.model.removeClassifier(a)})}}))(c)}]);angular.module("d3-uml-modeler.uml-diagram").factory("DiagramView",["BaseView","Constants","_",function(c,e,d){return c.extend({classifiersContainer:null,rawSVG:null,svg:null,grid:null,dragBehavior:null,selector:null,selectionGroup:null,selectionGroupX1:0,selectionGroupY1:0,selectorX1:0,selectorY1:0,selectedClassifiers:{},keyboardEventInitiated:!1,init:function(a,b,d){c.prototype.init.call(this,a,b,d);this.svg=d3.select(this.$el).select("svg");this.rawSVG=this.svg[0][0];this.svgNode=this.svg.select(".first-g");
this.classifiersContainer=this.svgNode.select(".classifiers-container");this.selector=this.svgNode.select(".selector");this.selectionGroup=this.svgNode.select(".selectionGroup").datum({x:0,y:0});this.initListeners();this.initDragBehavior()},initListeners:function(){this.notifications.addEventListener("classifier-selected",this.onClassifierSelected,this);this.notifications.addEventListener("classifier-deselected",this.onClassifierDeselected,this);this.svgNode.on("mousedown",angular.bind(this,this.onDiagramMouseDown));
this.notifications.addEventListener("show-resizer",this.showResizer,this)},onClassifierSelected:function(a){if("undefined"===typeof a||null===a)throw Error("modelClassifier is undefined/null");d.has(this.selectedClassifiers,a.GUID)||(this.selectedClassifiers[a.GUID]=a,1<d.values(this.selectedClassifiers).length&&this.makeSelectedClassifiersDraggable(),this.initKeyboardEvents())},onClassifierDeselected:function(a){if("undefined"===typeof a||null===a)throw Error("modelClassifier is undefined/null");
d.has(this.selectedClassifiers,a.GUID)&&(this.selectedClassifiers[a.GUID]=null,delete this.selectedClassifiers[a.GUID],this.removeClassifierFromSelectionGroup(a.GUID),this.removeKeyboardEvents())},initKeyboardEvents:function(){if(!this.keyboardEventInitiated){this.keyboardEventInitiated=!0;var a=this;d3.select("body").on("keydown",function(){46===(d3.event.keyCode||d3.event.which)&&a.removeSelectedClassifiers()})}},removeKeyboardEvents:function(){d.isEmpty(this.selectedClassifiers)&&this.keyboardEventInitiated&&
(d3.select("body").on("keydown",null),this.keyboardEventInitiated=!1)},removeSelectedClassifiers:function(){d.each(d.keys(this.selectedClassifiers),function(a){this.$scope.removeClassifier(a)},this)},makeSelectedClassifiersDraggable:function(){var a=[];d.each(d.keys(this.selectedClassifiers),function(b){b=this.classifiersContainer.select("#g-classifier-controller-"+b);var c=b.data()[0];c.width=+b.attr("data-width");c.height=+b.attr("data-height");a.push(c);this.addClassifierToSelectionGroup(b,c)},
this)},addClassifierToSelectionGroup:function(a,b){if(a&&(a[0]&&a[0][0])&&a[0][0].parentNode!==this.selectionGroup[0][0]){var c,d;c=a.data()[0].x;d=a.data()[0].y;this.selectionGroup[0][0].appendChild(a[0][0]);a.attr("data-x",c).attr("data-y",d).datum({x:c,y:d});this.selectionGroup.append("svg:rect").attr("class","selection-group-classifier-rect").attr("x",b.x).attr("y",b.y).attr("width",b.width).attr("height",b.height)}},removeClassifierFromSelectionGroup:function(a){if((a=this.selectionGroup.select("#g-classifier-controller-"+
a))&&(a[0]&&a[0][0])&&a[0][0].parentNode===this.selectionGroup[0][0]){var b,c;b=+a.attr("data-x")+this.selectionGroup.data()[0].x;c=+a.attr("data-y")+this.selectionGroup.data()[0].y;this.classifiersContainer[0][0].appendChild(a[0][0]);a.attr("transform","translate("+[b,c]+")").datum({x:b,y:c})}},initDragBehavior:function(){var a=this;this.dragBehavior=d3.behavior.drag().origin(Object).on("dragstart",angular.bind(this,this.onDragStart)).on("drag",angular.bind(this,this.onDragMove)).on("dragend",angular.bind(this,
this.onDragEnd));this.selectorDragBehavior=d3.behavior.drag().origin(Object).on("dragstart",function(b){d3.event.sourceEvent.stopPropagation();a.selectionGroupX1=b.x;a.selectionGroupY1=b.y;console.log("start");console.log([a.selectionGroupX1,a.selectionGroupY1])}).on("drag",function(a){a.x=d3.event.x;a.y=d3.event.y;console.log([a.x,a.y]);d3.select(this).attr("transform","translate("+[a.x,a.y]+")")});this.selectionGroup.call(this.selectorDragBehavior)},onDragStart:function(){this.selectorX1=d3.mouse(this.rawSVG)[0];
this.selectorY1=d3.mouse(this.rawSVG)[1];this.svgNode[0][0].appendChild(this.selector[0][0])},onDragMove:function(){var a=d3.mouse(this.rawSVG)[0],b=d3.mouse(this.rawSVG)[1],c=Math.abs(a-this.selectorX1),d=Math.abs(b-this.selectorY1),a=Math.min(a,this.selectorX1),b=Math.min(b,this.selectorY1);this.selector.attr("x",a).attr("y",b).attr("width",c).attr("height",d)},onDragEnd:function(){this.checkIntersectedElements();this.hideSelector()},checkIntersectedElements:function(){var a=this.rawSVG.createSVGRect();
a.x=this.selector.attr("x");a.y=this.selector.attr("y");a.width=this.selector.attr("width");a.height=this.selector.attr("height");this.notifications.notify("hit-test",this.rawSVG,a)},onDiagramMouseDown:function(){console.log("DiagramView::onDiagramClick");this.hideResizers();this.hideSelector();this.selectionGroup.datum({x:0,y:0}).attr("transform","translate(0,0)").selectAll(".selection-group-classifier-rect").remove()},hideSelector:function(){this.svg.call(this.dragBehavior);this.selector.attr("x",
d3.mouse(this.rawSVG)[0]).attr("y",d3.mouse(this.rawSVG)[1]).attr("width",0).attr("height",0)},hideResizers:function(){this.notifications.notify("hide-resizer")},drawBase:function(){this.svg.attr("width",this.config.width+this.marginLeft()+this.marginRight()).attr("height",this.config.height+this.marginTop()+this.marginBottom());this.svgNode.attr("width",this.config.width+this.marginLeft()+this.marginRight()).attr("height",this.config.height+this.marginTop()+this.marginBottom());this.svgNode.select(".diagram-bg").attr("width",
this.config.width).attr("height",this.config.height);this.drawGrid()},drawGrid:function(){this.grid=this.svgNode.select(".grid");var a,b=this.config.width/this.config.gridTicksPadding;for(a=0;a<b;a++)this.drawLine(a*this.config.gridTicksPadding,0,a*this.config.gridTicksPadding,this.config.height);for(a=0;a<b;a++)this.drawLine(0,a*this.config.gridTicksPadding,this.config.width,a*this.config.gridTicksPadding)},drawLine:function(a,b,c,d){this.grid.append("svg:line").attr("x1",a).attr("y1",b).attr("x2",
c).attr("y2",d)}})}]);angular.module("d3-uml-modeler.uml-diagram").factory("DiagramDirective",["DiagramView","BaseDirective","Constants","Notifications",function(c,e,d,a){return e.extend({init:function(a,c,d){e.prototype.init.call(this,a,c,d);this.draw()},initListeners:function(){e.prototype.initListeners.call(this)},draw:function(){var a=document.getElementById("section-content").clientWidth,e=document.getElementById("section-content").clientHeight;this.view=new c(this.$scope,this.$element[0],{width:a-(d.DIAGRAM_MARGIN.LEFT+
d.DIAGRAM_MARGIN.RIGHT),height:e-(d.DIAGRAM_MARGIN.TOP+d.DIAGRAM_MARGIN.BOTTOM),gridTicksPadding:20,gridColor:"gray"});this.view.render()},positionBase:function(){this.svgNode.attr("transform","translate("+this.marginLeft()+","+this.marginTop()+")")}})}]);angular.module("d3-uml-modeler.uml-diagram").directive("diagram",["DiagramDirective",function(c){return{restrict:"E",templateUrl:"views/diagram.html",link:function(e,d,a){new c(e,d,a)}}}]);angular.module("d3-uml-modeler.uml-workspace").factory("WorkspaceModelClass",["UmlModelAbstractFactory","Constants","BaseModelElement","_",function(c,e,d,a){return d.extend({addDiagram:function(a,c){return this.createElement(a,c)},removeDiagram:function(a){return this.removeElement(a)}})}]);angular.module("d3-uml-modeler.uml-workspace").directive("workspaceNavbar",[function(){return{restrict:"E",replace:!0,templateUrl:"views/workspace-navbar.html"}}]);angular.module("d3-uml-modeler.uml-workspace").directive("workspaceTreeItem",["$compile",function(c){return{restrict:"E",replace:!0,templateUrl:"views/workspace-tree-item.html",link:function(e,d,a){a=angular.element('<workspace-tree-item ng-repeat="model in model.children"></workspace-tree-item>');e=c(a)(e);d=d.find(".dd-list")[0];$(d).append(e);$(".dd").nestable()}}}]);
angular.module("d3-uml-modeler.uml-workspace").directive("workspaceTree",["Firebase",function(c){return{restrict:"E",replace:!0,templateUrl:"views/workspace-tree.html",link:function(c,d,a){}}}]);angular.module("d3-uml-modeler.uml-workspace").controller("WorkspaceController",["$scope","_","Notifications","WorkspaceModelClass","Constants","UmlController","UmlModelAbstractFactory","$rootScope","UserModel","FirebaseSyncController",function(c,e,d,a,b,f,h,k,m,n){return new (f.extend({user:null,model:null,isSaving:!1,isPending:!1,isModelSynced:!1,init:function(b){this.model=new a;f.prototype.init.call(this,b,d);this.$scope.model=angular.bind(this,this.model);this.$scope.diagrams=angular.bind(this,
this.model.children)},initScope:function(){this.$scope.diagrams=angular.bind(this,this.model.children);this.$scope.children=angular.bind(this,this.model.children);this.$scope.sync=angular.bind(this,this.sync);this.$scope.username="";this.$scope.userPicture=""},initListeners:function(){k.$on("$firebaseSimpleLogin:login",angular.bind(this,this.onLoginSuccess));k.$on("$firebaseSimpleLogin:logout",angular.bind(this,this.onLogout));this.notifications.addEventListener(b.DIAGRAM.EVENTS.ADD,this.addDiagram,
this)},initWorkspaceModel:function(a){if("undefined"===typeof a||null===a)throw Error("rawUser is undefined/null");this.user=n.getUser(a.uid);a=n.getUserDiagrams(a.uid);var b=this;k.modelUser=new m;a.on("value",function(a){!1===b.isSaving&&(a=a.val(),k.modelUser.diagrams=a,e.isEmpty(a)||(b.model.clearChildren(),console.log("WorkspaceController::initWorkspaceModel constructing workspace model tree"),e.each(a,function(a){a=h.createModelHierarchy(a);b.model.addElement(a)})))})},onLoginSuccess:function(a,
b){this.isPending=!this.isPending;this.isModelSynced||(this.initWorkspaceModel(b),this.isModelSynced=!0,this.isPending=!1,this.$scope.userPicture=b.thirdPartyUserData.profile_image_url,this.$scope.username="@"+b.username)},onLogout:function(){this.$scope.username="";this.$scope.userPicture=""},addDiagram:function(a){this.model.addDiagram(a)},sync:function(){var a=this.model.toJSON();this.isSaving=!0;console.log("synchronizing data ...");this.user.diagrams=a.children;this.user.$save("diagrams");console.log("Data synchronization done !");
this.isSaving=!1}}))(c,e,d,a,b)}]);angular.module("d3-uml-modeler.element-list").provider("ElementList",Class.extend({$get:["Constants","_","BaseModelElement","EventDispatcher",function(c,e,d,a){var b=a.extend({index:0,name:"",type:0,GUID:null,init:function(a,b,c){this.index=b;this.name=a;this.type=c;this.GUID=Util.guid()}});return new (d.extend({initElements:function(){var a=c.ELEMENT_LIST;if("undefined"!==typeof a&&null!==a){var d=0;e.each(a,function(a){var f=a.type,f=e.has(a,"children")?"-":"function"==typeof a.type?a.type.apply(c):
a.type,f=new b(a.name,d,f);this.addElement(f);d++;e.has(a,"children")&&e.each(a.children,function(a){var e="function"==typeof a.type?a.type.apply(c):a.type;a=new b(a.name,d,e);this.addElement(a);d++},this)},this)}}}))}]}));angular.module("d3-uml-modeler.element-list").controller("ElementListController",["$scope","_","Notifications","ElementList","Constants","UmlController",function(c,e,d,a,b,f){return new (f.extend({elementList:null,init:function(a,b,c,d,e){this.elementList=d;this.initScope=function(){this.$scope.children=b.sortBy(b.values(this.elementList.children),"index",this);this.$scope.addElementClick=angular.bind(this,this.addElementClick)};this.addElementClick=function(a){if("undefined"===typeof a||null===a)throw Error("ElementListController::addElementClick => Element is undefined");
b.each([e.DIAGRAM,e.CLASSIFIER,e.ASSOCIATION],function(c){0<=b.values(c.TYPES).indexOf(a.type)&&this.notifications.notify(c.EVENTS.ADD,a.type)},this)};f.prototype.init.call(this,a,c)}}))(c,e,d,a,b)}]);angular.module("d3-uml-modeler.filters",[]).filter("interpolate",["version",function(c){return function(e){return String(e).replace(/\%VERSION\%/mg,c)}}]);angular.module("d3-uml-modeler.filters",[]).filter("propertyTypeFilter",["_",function(c){return function(e,d){return c.filter(e,function(a){return c.isEqual(d,c.pick(a,c.keys(d)))})}}]);app=angular.module("d3-uml-modeler.directives",[]);app.directive("umlComponent",function(){return{templateUrl:function(c,e){return"views/"+e.umlComponent+".html"}}});app.directive("workspace",function(){return{restrict:"E",templateUrl:"views/workspace.html",link:function(c,e,d){}}});app.directive("classDiagram",function(){return{require:"?umlComponent",templateUrl:"views/class-diagram.html"}});
